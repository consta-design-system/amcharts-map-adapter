import { MdxMenu } from '@consta/stand';
import { AmChartsMapExample } from './examples/AmChartsMapExample/AmChartsMapExample';

# am-charts MapChart

<MdxMenu>

- [Начало работы](#начало-работы)
  - [Создание полотна](#создание-полотна)
    - [Отрисовка карты](#отрисовка-карты)
    - [Проекция карты](#проекция-карты)
  - [Масштабирование и перемещение](#масштабирование-и-перемещение)
    - [Перемещение](#перемещение)
    - [Масштабирование](#масштабирование)
  - [Тема](#тема)
- [Пример](#пример)

</MdxMenu>

## Начало работы

Для того приступить к разработке вам небходимо скачать следующие пакеты:

- `@amcharts/amcharts5` - исходный пакет который отвечает за отрисовку элементов
- `@amcharts/amcharts5-geodata` - пакет в которм находятся данные в формате GeoJSON для всех стран и континентов

### Создание полотна

Для того чтобы создать полотно необходимо в хуке `useLayoutEffect` объявить исходный элемент куда будут понтироваться график,
а также само полотно карт:

```tsx
const root = am5.Root.new('map_id');
const chart = root.container.children.push(am5map.MapChart.new(root, {}));
```

#### Отрисовка карты

Далее для того чтобы отрисовать карту необходимо добавить серию полигонов самой карты, это делается через объект графика
следующим образом:

```tsx
import am5geodata_russiaHigh from '@amcharts/amcharts5-geodata/russiaHigh';

...

const polygonSeries = chart.series.push(
  am5map.MapPolygonSeries.new(root, {
    geoJSON: am5geodata_russiaHigh
  })
);
```

Также есть ещё нескоолько серий, каждая из которыз отвечает за оотдельный аспект отрисовки:

- `am5map.MapPolygonSeries` - отрисовка полигонов (форм) стран, континентов и регионов
- `am5map.MapLineSeries` - отрисовка линий на карте
- `am5map.MapPointSeries` - отрисовка маркеров (точек) на карте
- `am5map.GraticuleSeries` - отрисовка сетки карты

Все эти серии можно использовать в связке друг с другом, чтобы получить необходимый вам резулььтат.

#### Проекция карты

Есть много способов перевести сферическую поверхность планеты в плоскую карту. В картографии они называются проекциями.
Чтобы указать необходимую вам проекцию установите в настройках графика свойство `projection`, по умолчанию будет применена проекция `am5map.geoMercator()`:

```tsx
const chart = root.container.children.push(
  am5map.MapChart.new(root, {
    projection: am5map.geoEqualEarth(),
  }),
);
```

Со списком всех встроенных проекций и принципом подключения их, а также проекций D3 можно ознакомиться по [ссылке](https://www.amcharts.com/docs/v5/charts/map-chart/#Built_in_projections).

### Масштабирование и перемещение

Для того чтобы указать изнальное положение карты небходимо определить поля свойства `rotationX`, `rotationY` и/или `rotationZ`, указав в них отклонение
(по оси X - долгота, по оси Y - широта, Z - градус отклонения при использовании сферической проекции).

```tsx
const chart = root.container.children.push(
  am5map.MapChart.new(root, {
    rotationX: -55,
    rotationY: 10,
  }),
);
```

Для установки исходного положения и масштаба необходимо указать свойства `homeGeoPoint` и `homeZoomLevel`:

```tsx
const chart = root.container.children.push(
  am5map.MapChart.new(root, {
    homeZoomLevel: 3.5,
    homeGeoPoint: { longitude: 10, latitude: 52 }
  })
);

...

polygonSeries.events.on("datavalidated", function() {
  chart.goHome();
});
```

#### Перемещение

Принцип перемещения по карте определяется свойствами `panX` и `panY`:

- `'none'` - ничего не делать, при этом карта останется статической и не доступной для перемещения в определенном направлении (x или y)
- `'rotateX' 'rotateY'` - вращение карты, обоорачивая содержимое тем же образом как и при вращении земного шара
- `'translateX' 'translateY'` - перемещение содержимого карты без изменения внешнего вида

```tsx
const chart = root.container.children.push(
  am5map.MapChart.new(root, {
    panX: 'translateX',
    panY: 'rotateY',
  }),
);
```

#### Масштабирование

Шаг для мастштабирования карты определяется свойством `zoomStep` и по умолчанию имеет значение `2`.
Для того чтобы определить границы диапозона масштабирования необходиом указать значение свойств `minZoomLevel` и `maxZoomLevel`,
по умолчанию они имеют значения `1` и `32` соответственно.

Также есть методы API для масштабирования карты такие как:

- `zoomToPoint()` - центрирует и масштабирует карту до определенных координат X/Y в пикселях.
- `zoomToGeoPoint()` - центрирует и масштабирует карту до определенных координат широты/долготы и уровня масштабирования.
- `zoomIn()` - увеличивает карту, устанавливая значение `zoomStep`.
- `zoomIn()` - уменьшает карту, устанавливая значение `zoomStep`.

Также масштабирования или перемещения можно изменить через поведение колесика мыши `wheelX` и `wheelY`:

- `'none'` - ничего не делать, при этом карта останется статической и не доступной для перемещения в определенном направлении (x или y)
- `'rotateX' 'rotateY'` - вращение карты по горизонтали / вертикали, оборачивая содержимое тем же образом как и при вращении земного шара
- `'translateX' 'translateY'` - перемещение содержимого карты без изменения внешнего вида
- `'zoom'` - масштабирование карты, центрируя фактической положение курсоора мыши

Также можно указать чувствительность колесика мыши через свойство `wheelSensitivity`.
Для того чтобы отключить "щипковый зум" на мобильных устройствах, установите флаг `pinchZoom` в значение `false`

```tsx
const chart = root.container.children.push(
  am5map.MapChart.new(root, {
    panX: 'rotateX',
    wheelY: 'zoom',
    wheelSensitivity: 0.7,
    pinchZoom: false,
  }),
);
```

Для добавления на карту кнопок масштабирования, необходимо создать и установить в график объект `ZoomControl`:

```tsx
chart.set('zoomControl', am5map.ZoomControl.new(root, {}));
```

### Тема

Темы можно использовать для простого применения набора настроек к элементам полотна с помощью одной строки кода.

```tsx
import am5themes_Animated from "@amcharts/amcharts5/themes/Animated";

...

root.setThemes([am5themes_Animated.new(root)]);
```

Также вы можете сооздать свою тему основываясь на классе `Theme`:

```tsx
const myTheme = am5.Theme.new(root);

myTheme.rule('Label').setAll({
  fill: am5.color(0xff0000),
  fontSize: '1.5em',
});

root.setThemes([am5themes_Animated.new(root), myTheme]);
```

Или вы можете переопределить дефолтную тему, указав в элементах карт необходимые вам свойства.

## Пример

<AmChartsMapExample />
